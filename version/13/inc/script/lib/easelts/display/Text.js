var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c};define(["require","exports","./DisplayObject","../util/Methods","../geom/Bounds"],function(a,b,c,d,e){var f=function(a){function b(c,d,e){a.call(this,1,1,0,0,0,0),this._text="",this.font=null,this.color=null,this.textAlign=b.TEXT_ALIGN_LEFT,this.textBaseline=b.TEXT_BASELINE_TOP,this.maxWidth=null,this.outline=0,this.lineHeight=0,this.lineWidth=null,this._autoWidth=!0,this._autoHeight=!0,0==c.length&&(c=" "),this.text=c,this.font=d,this.color=e}return __extends(b,a),Object.defineProperty(b.prototype,"text",{get:function(){return this._text},set:function(a){a=a.replace(/\s+\n|\n\s+/g,"\n"),this._text!=a&&(this._text=a,this._autoWidth&&this.setWidth("auto"),this._autoHeight&&this.setHeight("auto"))},enumerable:!0,configurable:!0}),b.prototype.setWidth=function(b){"auto"==b?(this._autoWidth=!0,a.prototype.setWidth.call(this,this.getBounds().width)):(this._autoWidth=!1,a.prototype.setWidth.call(this,b))},b.prototype.setHeight=function(b){"auto"==b?(this._autoHeight=!0,a.prototype.setHeight.call(this,this.getMeasuredHeight())):(this._autoHeight=!1,a.prototype.setHeight.call(this,b))},b.prototype.isVisible=function(){var a=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.prototype.draw=function(b,c){if(a.prototype.draw.call(this,b,c))return!0;var d=this.color||"#000";return this.outline?(b.strokeStyle=d,b.lineWidth=1*this.outline):b.fillStyle=d,this._drawText(this._prepContext(b)),!0},b.prototype.getMeasuredWidth=function(){return this._getMeasuredWidth(this.text)},b.prototype.getExactSize=function(){var a=Math.ceil(this.getMeasuredWidth()),b=Math.ceil(1.6*a),c=!1,d=this.color;this.color="#000",this.cacheCanvas||(this.cache(0,0,a,b),c=!0);var f=this.cacheCanvas.getContext("2d"),g=f.getImageData(0,0,a,b);c&&this.uncache();for(var h=g.data,i=a,j=b,k=0,l=0,m=3,n=h.length,o=0;n>m;m+=4,++o){var p=o%a,q=Math.floor(o/a);(h[m-3]>0||h[m-2]>0||h[m-1]>0||h[m]>0)&&(i=Math.min(i,p),j=Math.min(j,q),k=Math.max(k,p),l=Math.max(l,q))}return this.color=d,new e(i,j,k,l,k-i,l-j)},b.prototype.getMeasuredLineHeight=function(){return 1.2*this._getMeasuredWidth("M")},b.prototype.getMeasuredHeight=function(){return this._drawText(null,{}).height},b.prototype.getBounds=function(){var c=a.prototype.getBounds.call(this);if(c)return c;if(null==this.text||""==this.text)return null;var d=this._drawText(null,{}),e=this.maxWidth&&this.maxWidth<d.width?this.maxWidth:d.width,f=e*b.H_OFFSETS[this.textAlign||"left"],g=this.lineHeight||this.getMeasuredLineHeight(),h=g*b.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.initialize(f,h,e,d.height)},b.prototype.getMetrics=function(){var a={lines:[]};return a.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),a.vOffset=a.lineHeight*b.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,a,a.lines)},b.prototype.clone=function(){var a=new b(this.text,this.font,this.color);return this.cloneProps(a),a},b.prototype.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},b.prototype.cloneProps=function(b){a.prototype.cloneProps.call(this,b),b.textAlign=this.textAlign,b.textBaseline=this.textBaseline,b.maxWidth=this.maxWidth,b.outline=this.outline,b.lineHeight=this.lineHeight,b.lineWidth=this.lineWidth},b.prototype._prepContext=function(a){return a.font=this.font||"10px sans-serif",a.textAlign=this.textAlign||"left",a.textBaseline=this.textBaseline||"top",a},b.prototype._drawText=function(a,c,d){var e=!!a;e||(a=b._workingContext,a.save(),this._prepContext(a));for(var f=this.lineHeight||this.getMeasuredLineHeight(),g=0,h=0,i=String(this._text).split(/(?:\r\n|\r|\n)/),j=0,k=i.length;k>j;j++){var l=i[j],m=null;if(null!=this.lineWidth&&(m=a.measureText(l).width)>this.lineWidth){var n=l.split(/(\s)/);l=n[0],m=a.measureText(l).width;for(var o=1,p=n.length;p>o;o+=2){var q=a.measureText(n[o]+n[o+1]).width;m+q>this.lineWidth?(e&&this._drawTextLine(a,l,h*f),d&&d.push(l),m>g&&(g=m),l=n[o+1],m=a.measureText(l).width,h++):(l+=n[o]+n[o+1],m+=q)}}e&&this._drawTextLine(a,l,h*f),d&&d.push(l),c&&null==m&&(m=a.measureText(l).width),m>g&&(g=m),h++}return c&&(c.width=g,c.height=h*f),e||a.restore(),c},b.prototype._drawTextLine=function(a,b,c){this.outline?a.strokeText(b,0,c,this.maxWidth||65535):a.fillText(b,0,c,this.maxWidth||65535)},b.prototype._getMeasuredWidth=function(a){var c=b._workingContext;c.save();var d=this._prepContext(c).measureText(a).width;return c.restore(),d},b.TEXT_BASELINE_TOP="top",b.TEXT_BASELINE_HANGING="hanging",b.TEXT_BASELINE_MIDDLE="middle",b.TEXT_BASELINE_ALPHABETIC="alphabetic",b.TEXT_BASELINE_IDEOGRAPHIC="ideographic",b.TEXT_BASELINE_BOTTOM="bottom",b.TEXT_ALIGN_START="start",b.TEXT_ALIGN_END="end",b.TEXT_ALIGN_LEFT="left",b.TEXT_ALIGN_RIGHT="right",b.TEXT_ALIGN_CENTER="center",b.TEXT_ALIGN_BOTTOM="bottom",b.H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1},b.V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},b}(c),g=d.createCanvas();return g.getContext&&(f._workingContext=g.getContext("2d"),g.width=g.height=1),f});
//# sourceMappingURL=../../../../sourcemap/lib/easelts/display/Text.js.map